# DApp 开发任务拆分文档

本文档基于《需求文档》和《技术方案设计文档》，将整个 DApp 的开发过程拆分为一系列具体、可执行的任务。每个任务都设计为在完成后能够产出可见的阶段性成果。

## 第一阶段：项目初始化与基础页面搭建

### 任务 1.1: 初始化项目并集成基础依赖
- **描述:** 创建一个全新的 Next.js (App Router) 项目，并集成 `wagmi`, `@rainbow-me/rainbowkit`, `viem` 和 `tailwindcss`。
- **可交付成果:**
    - 一个可以成功运行的 Next.js 项目。
    - `package.json` 中包含所有必需的依赖项。
    - 基本的项目结构已按技术方案设置。

### 任务 1.2: 实现钱包连接功能
- **描述:** 创建 `Web3Provider` 来配置 `wagmi` 和 `RainbowKit`，并在主页面上添加 `ConnectButton` 以实现钱包连接/断开功能。
- **可交付成果:**
    - 页面右上角出现一个“连接钱包”按钮。
    - 用户可以点击按钮，通过 RainbowKit 模态框成功连接自己的钱包。
    - 连接后，按钮上显示用户的地址和头像，并提供断开连接的选项。

## 第二阶段：核心数据显示

### 任务 2.1: 显示用户账户信息
- **描述:** 创建 `AccountInfo` 组件，用于显示当前连接用户的地址、ETH 余额和指定的 ERC20 Token 余额。
- **可交付成果:**
    - 页面上新增一个区域，清晰地展示用户的钱包地址。
    - 该区域能正确显示用户的 ETH 余额。
    - 该区域能正确显示用户的 ERC20 Token 余额。

### 任务 2.2: 读取并展示 TokenBank 合约信息
- **描述:** 创建 `TokenBank` 组件的初始版本，使用 `useReadContract` 读取并展示 `TokenBank` 合约的总存款额 (`totalDeposited`) 和当前用户的存款额 (`deposits`)。
- **可交付成果:**
    - 页面上新增一个“TokenBank 信息”区域。
    - 该区域能正确显示从链上读取到的合约总存款。
    - 该区域能正确显示当前用户在合约中的存款。

## 第三阶段：实现核心交易功能

### 任务 3.1: 实现 TokenBank 存款功能 (授权 + 存款)
- **描述:** 在 `Erc20Actions` 中实现授权功能，并在 `TokenBank` 组件中实现存款功能。用户需要先授权，然后才能存款。
- **可交付成果:**
    - 页面上出现“授权”和“存款”的表单和按钮。
    - 用户可以成功授权指定数量的 Token 给 `TokenBank` 合约。
    - 授权后，用户可以成功将 Token 存入 `TokenBank` 合约。
    - 存款成功后，“个人存款”和“总存款”的数据会实时更新。

### 任务 3.2: 实现 ERC20 Token 转账功能
- **描述:** 创建 `Erc20Actions` 组件，并实现其中的 Token 转账功能。包含输入字段和“转账”按钮，并使用 `useWriteContract` 发起交易。
- **可交付成果:**
    - 页面上出现一个转账表单，包含接收方地址和金额输入框。
    - 用户填写表单并点击“转账”后，钱包会弹出交易确认请求。
    - 交易成功后，用户的 ERC20 Token 余额会相应减少（可通过 `AccountInfo` 组件验证）。

### 任务 3.3: 实现 TokenBank 取款功能
- **描述:** 在 `TokenBank` 组件中实现取款功能。用户可以从合约中取出自己的存款。
- **可交付成果:**
    - 页面上出现“取款”表单和按钮。
    - 用户可以成功从 `TokenBank` 合约中取出自己的 Token。
    - 取款成功后，“个人存款”、“总存款”以及用户的 Token 余额会实时更新。

## 第四阶段：优化用户体验

### 任务 4.1: 增加交易状态反馈
- **描述:** 利用 `useWriteContract` 的 `isPending` 和 `useWaitForTransactionReceipt` 的 `isLoading` 状态，为所有交易（转账、授权、存款、取款）添加精细的状态反馈。
- **可交付成果:**
    - 点击交易按钮后，按钮变为禁用状态并显示“等待钱包确认...”。
    - 钱包确认后，按钮显示“交易确认中...”。
    - 交易成功或失败后，按钮恢复正常状态。

### 任务 4.2: 实现成功/失败通知与数据刷新
- **描述:** 使用 `useWaitForTransactionReceipt` 的 `isSuccess` 和 `isError` 状态，在交易完成后给用户明确的 Toast 通知。并确保在成功后自动刷新所有相关的链上数据。
- **可交付成果:**
    - 交易成功后，屏幕上弹出“交易成功”的提示。
    - 交易失败后，屏幕上弹出具体的错误信息提示。
    - 所有成功的写入操作都会立即触发相关数据（如余额、存款额）的刷新，UI 自动更新。

### 任务 4.3: 显示授权额度 (Allowance)
- **描述:** 在 `AccountInfo` 或 `TokenBank` 组件中，使用 `useReadContract` 读取并显示用户当前对 `TokenBank` 合约的 ERC20 Token 授权额度。
- **可交付成果:**
    - 页面上新增一项数据显示，告知用户当前的授权额度是多少。
    - “存款”按钮的可用性可以根据授权额度与存款金额的比较来动态控制。