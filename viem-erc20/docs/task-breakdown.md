# Viem ERC20 DApp - 任务拆分计划 (重构版)

本文档基于《需求文档》和《技术设计文档》，将 DApp 开发过程重新拆分为更具体、可独立验证的模块化任务。每个任务完成后都应有明确的、可交互的 UI 界面或功能效果，以便于迭代和验证。

---

## 模块一：项目初始化与钱包连接

**目标**: 搭建项目基础架构，实现最核心的钱包连接功能，为后续所有功能提供基础。

- **任务 1.1: 初始化项目并配置基础环境**
  - **操作**:
    - [ ] 使用 `pnpm create next-app` 创建 Next.js + TypeScript + Tailwind CSS 项目。
    - [ ] 安装核心依赖：`viem`, `wagmi`, `@rainbow-me/rainbowkit`。
    - [ ] 根据技术设计文档，创建规范的目录结构（`app`, `components`, `config`, `constants`, `context`）。
  - **验证**:
    - 项目可正常启动 (`pnpm dev`)，并显示 Next.js 默认页面。
    - `package.json` 中包含所有必需的依赖。

- **任务 1.2: 配置 Web3 Provider 并展示连接按钮**
  - **操作**:
    - [ ] 在 `src/config/wagmi.ts` 中创建 Wagmi 和 Viem 客户端配置。
    - [ ] 在 `src/context/Web3Provider.tsx` 中封装 `WagmiConfig` 和 `RainbowKitProvider`。
    - [ ] 在 `src/app/layout.tsx` 中全局应用 `Web3Provider`。
    - [ ] 在主页 `src/app/page.tsx` 中引入并展示 RainbowKit 的 `ConnectButton`。
  - **验证**:
    - 页面右上角出现一个功能完备的 “Connect Wallet” 按钮。
    - 用户可以点击按钮，选择钱包（如 MetaMask）并成功连接。
    - 连接后，按钮上能正确显示用户的钱包地址和原生代币（如 ETH）余额。

---

## 模块二：读取并展示 ERC20 合约信息

**目标**: 实现从区块链读取只读数据，让用户能看到 ERC20 合约的实时状态。

- **任务 2.1: 创建 ERC20 信息展示组件**
  - **操作**:
    - [ ] 在 `src/constants/index.ts` 中定义 ERC20 合约地址和 ABI（至少包含 `owner`, `totalSupply`）。
    - [ ] 创建 `src/components/Erc20Info.tsx` 组件。
    - [ ] 使用 `useReadContracts` hook 并行读取合约的 `owner` 和 `totalSupply`。
    - [ ] 在组件中以卡片形式展示数据，并处理加载状态。
    - [ ] 在主页 `src/app/page.tsx` 中集成此组件。
  - **验证**:
    - 页面上出现一个新模块，用于显示 ERC20 合约信息。
    - 即使不连接钱包，也能正确显示合约的发行方地址和总发行量。
    - 数据加载时，有明确的加载提示。

- **任务 2.2: 读取并展示用户持有的代币余额**
  - **操作**:
    - [ ] 在 `src/constants/index.ts` 中的 ABI 添加 `balanceOf` 函数。
    - [ ] 在 `Erc20Info.tsx` 组件中，修改 `useReadContracts` hook，使其在用户连接钱包后，额外读取当前用户的 `balanceOf`。
  - **验证**:
    - 用户连接钱包后，ERC20 信息模块中会新增一项，显示该用户的代币余额。
    - 用户断开钱包连接后，余额信息消失。

---

## 模块三：实现 ERC20 代币铸造 (Mint) 功能

**目标**: 实现向合约写入数据的核心功能，允许用户通过发送交易来为自己铸造代币。

- **任务 3.1: 开发 Mint UI 及写入逻辑**
  - **操作**:
    - [ ] 在 `Erc20Info.tsx` 组件中，添加一个输入框（用于指定铸造数量）和一个 “Mint” 按钮。
    - [ ] 对输入框进行基础校验（例如，确保为数字且不超过 10,000）。
    - [ ] 使用 `useWriteContract` hook 配置 `mint` 函数的调用。
  - **验证**:
    - Mint UI 元素显示正常。
    - 用户输入数量并点击 “Mint” 按钮后，钱包会弹出交易确认请求。

- **任务 3.2: 实现交易状态反馈与余额自动刷新**
  - **操作**:
    - [ ] 使用 `useWaitForTransactionReceipt` hook 监听 `mint` 交易的状态。
    - [ ] 根据交易状态（发送中、等待确认、成功、失败）向用户显示不同的 UI 反馈。
    - [ ] 在交易成功的回调中，调用 `useReadContracts` 返回的 `refetch` 函数，以自动更新 UI 上的用户余额。
  - **验证**:
    - 交易发送后，UI 会显示 “交易发送中...” 或类似的提示。
    - 交易成功后，UI 显示 “铸造成功！” 提示，并且页面上显示的代币余额会自动更新为最新值，无需手动刷新。

---

## 模块四：实现 ETH 转账功能

**目标**: 完成需求文档中的原生代币转账功能，丰富 DApp 的交互能力。

- **任务 4.1: 开发 ETH 转账组件及核心逻辑**
  - **操作**:
    - [ ] 创建 `src/components/EthTransfer.tsx` 组件。
    - [ ] 添加接收方地址和转账金额的输入框，以及 “Send ETH” 按钮。
    - [ ] 使用 `useSendTransaction` hook 发送原生代币（ETH）。
    - [ ] 使用 `useWaitForTransactionReceipt` 提供交易状态反馈。
    - [ ] 在主页 `src/app/page.tsx` 中集成此组件。
  - **验证**:
    - 页面上出现一个独立的 ETH 转账模块。
    - 用户可以填入有效地址和金额，成功发起一笔 ETH 转账交易，并能看到交易状态反馈。

---

## 模块五：UI/UX 优化与收尾

**目标**: 优化应用整体的视觉效果和用户体验，使其更专业、更易用。

- **任务 5.1: 格式化数据与优化样式**
  - **操作**:
    - [ ] 创建 `src/utils/format.ts`，添加格式化地址、代币数量的工具函数。
    - [ ] 使用 Tailwind CSS 美化所有组件，统一布局、颜色和字体。
  - **验证**:
    - 应用界面美观、布局合理。
    - 地址（如 `0x123...def`）和代币数量（如 `10,000.00`）都经过格式化，易于阅读。

- **任务 5.2: 完善错误处理**
  - **操作**:
    - [ ] 完善各个交互环节的错误处理，例如用户拒绝交易、输入无效地址、RPC 错误等。
    - [ ] 使用 toast 通知或在 UI 上明确展示错误信息。
  - **验证**:
    - 当用户在钱包中拒绝交易时，应用会给出明确提示。
    - 当发生其他错误时，用户能收到友好的错误反馈，而不是看到应用崩溃或无响应。